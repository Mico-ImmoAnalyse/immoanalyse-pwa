<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ImmoAnalyse v3.4.1</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root {
      --bg: #050816;
      --card: #0b1020;
      --card-soft: #11172a;
      --emerald: #22c55e;
      --blue: #3b82f6;
      --amber: #f59e0b;
      --rose: #fb7185;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-soft: #1f2937;
      --gold: #facc15;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #111827 0, #020617 55%);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    h1 {
      font-size: 1.4rem;
      margin: 18px 0 10px;
    }

    .dashboard {
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 16px 40px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .top-bar-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .btn {
  border-radius: 999px;
  border: 1px solid var(--border-soft);
  background: var(--card);
  color: var(--text-main);
  padding: 6px 12px;
  font-size: 0.8rem;
  cursor: pointer;
}

    .btn-gold {
      background: linear-gradient(135deg, #facc15, #eab308);
      border: none;
      color: #111827;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(250, 204, 21, 0.35);
    }

    .btn-ghost {
      background: transparent;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin: 18px 0 20px;
    }

    .summary-card {
  background: var(--card);
  border-radius: 14px;
  padding: 14px 16px;
  border: 1px solid var(--border-soft);
  box-shadow: 0 18px 45px rgba(0, 0, 0, 0.15);
}

    .summary-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .summary-value {
      font-size: 1.4rem;
      font-weight: 600;
    }

    .summary-tag {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

   .card {
  background: var(--card);
  border-radius: 16px;
  border: 1px solid var(--border-soft);
  padding: 16px 16px 18px;
  box-shadow: 0 24px 60px rgba(0, 0, 0, 0.25);
  margin-top: 10px;
    }

    .card h2 {
      font-size: 0.95rem;
      margin: 0 0 10px;
    }

    .form-body {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px 14px;
      align-items: flex-end;
    }

    label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 3px;
    }

    input, select {
  width: 100%;
  padding: 6px 8px;
  border-radius: 8px;
  border: 1px solid var(--border-soft);
  background: var(--card-soft);
  color: var(--text-main);
  font-size: 0.8rem;
}

    input:focus, select:focus {
      outline: 1px solid var(--blue);
      border-color: var(--blue);
    }

  .table-wrapper {
  background: var(--card);
  border-radius: 16px;
  border: 1px solid var(--border-soft);
  overflow: hidden;
  box-shadow: 0 24px 60px rgba(0, 0, 0, 0.15);
  margin-top: 18px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
    }

   thead {
  background: var(--card-soft);
    }

    th, td {
  padding: 10px 12px;
  border-bottom: 1px solid var(--border-soft);
  vertical-align: top;
  color: var(--text-main);
   }

    th {
      text-align: left;
      font-weight: 500;
      color: var(--text-soft);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

  tr:hover td {
  background: var(--card-soft);
  }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .badge-premium {
  background: color-mix(in srgb, var(--emerald) 15%, transparent);
  color: var(--emerald);
  border: 1px solid color-mix(in srgb, var(--emerald) 40%, transparent);
    }

.badge-safe {
  background: color-mix(in srgb, var(--blue) 15%, transparent);
  color: var(--blue);
  border: 1px solid color-mix(in srgb, var(--blue) 40%, transparent);
    }

.badge-tendu {
  background: color-mix(in srgb, var(--amber) 15%, transparent);
  color: var(--amber);
  border: 1px solid color-mix(in srgb, var(--amber) 40%, transparent);
   }

.badge-critique {
  background: color-mix(in srgb, var(--rose) 15%, transparent);
  color: var(--rose);
  border: 1px solid color-mix(in srgb, var(--rose) 40%, transparent);
   }

   .help-panel {
  position: fixed;
  top: 0;
  right: -420px;
  width: 400px;
  height: 100vh;
  background: var(--card);
  border-left: 1px solid var(--border-soft);
  padding: 20px 18px 24px;
  overflow-y: auto;
  transition: right .25s ease-out;
  z-index: 40;
   }

    .help-panel.open {
      right: 0;
    }

    .help-panel h2 {
      font-size: 1rem;
      margin-bottom: 8px;
    }

    .help-panel h3 {
      font-size: 0.9rem;
      margin-top: 16px;
      margin-bottom: 6px;
    }

    .help-panel p, .help-panel li {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    #overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(4px);
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease-out;
  z-index: 30;
   }

    #overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 900px) {
      .summary-grid {
        grid-template-columns: 1fr;
      }
      .form-body {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .form-body {
        grid-template-columns: 1fr;
      }
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
    }
 /* --- MODE CLAIR (align√© sur ton th√®me sombre) --- */
body.light {
  --bg: #f3f4f6;            /* Fond clair mais pas blanc pur */
  --card: #ffffff;          /* Cartes blanches nettes */
  --card-soft: #f1f5f9;     /* Cartes secondaires */
  
  --text-main: #1f2937;     /* Texte principal gris anthracite */
  --text-soft: #6b7280;     /* Texte secondaire */
  
  --border-soft: #d1d5db;   /* Bordures visibles mais douces */
  
  --emerald: #16a34a;       /* Vert adapt√© au clair */
  --blue: #2563eb;          /* Bleu plus lisible sur fond clair */
  --amber: #d97706;         /* Orang√© adapt√© */
  --rose: #dc2626;          /* Rouge lisible */
  --gold: #ca8a04;          /* Or pour badges premium */
}

/* Transition douce entre les th√®mes */
body {
  transition: background 0.3s ease, color 0.3s ease;
}
  </style>
</head>
<body class="dark">

<div class="dashboard">

  <div class="top-bar">
    <div>
      <h1>ImmoAnalyse v3.4.1</h1>
      <div style="font-size:0.8rem; color:var(--text-soft);">
        Moteur IA v3.4.0 ‚Äì LTV / LTA / LTC / Marge / Pr√©‚Äëcom / Liquidit√© / Garantie
      </div>
    <div class="top-bar-right">
  <button class="btn btn-ghost" onclick="toggleHelp()">Guide v3.4.0</button>
  <button class="btn" onclick="exportCSV()">Export CSV</button>
 <button id="themeBtn" class="btn" onclick="toggleTheme()">Mode clair</button>
</div>
  </div>

  <div class="summary-grid">
    <div class="summary-card">
      <div class="summary-label">Score moyen du portefeuille</div>
      <div class="summary-value" id="avgRisk">0/100</div>
      <div class="summary-tag" id="riskLabel">Aucun projet</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Total investi</div>
      <div class="summary-value" id="totalInvest">0 ‚Ç¨</div>
      <div class="summary-tag">Capital engag√© sur les dossiers audit√©s</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Moteur IA</div>
      <div class="summary-tag">
        Scoring automatique, statuts PREMIUM / SAFE / TENDU / CRITIQUE, bridage des tickets selon le risque.
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Nouvel audit</h2>
    <div class="form-body">

      <div style="grid-column: span 2;">
        <label>Projet</label>
        <input type="text" id="nom" placeholder="Nom du dossier">
      </div>

      <div>
        <label>LTV (%)</label>
        <input type="number" id="ltv" value="70">
      </div>

      <div>
        <label>Marge (%)</label>
        <input type="number" id="marge" value="15">
      </div>

      <div>
        <label>Pr√©-Comm (%)</label>
        <input type="number" id="precom" value="0">
      </div>

      <div>
        <label>Liq. (1-10)</label>
        <input type="number" id="liq" value="7">
      </div>

      <div>
        <label>S√ªret√©</label>
        <select id="typeSurete">
          <option value="fid">Fiducie-S√ªret√©</option>
          <option value="hypo">Hypoth√®que 1er R.</option>
        </select>
      </div>

      <div>
        <label>Couv. (%)</label>
        <input type="number" id="cov" value="100">
      </div>

      <div>
        <label>LTA (%)</label>
        <input type="number" id="lta" placeholder="Ex: 95">
      </div>

      <div>
        <label>LTC (%)</label>
        <input type="number" id="ltc" placeholder="Ex: 88">
      </div>

      <div>
        <label>Mise (‚Ç¨)</label>
        <input type="number" id="realInvest" placeholder="Ex: 500">
      </div>

      <div style="grid-column: span 4; text-align:right; margin-top:4px;">
        <button class="btn btn-gold" onclick="ajouterProjet()">AUDITER & SAUVEGARDER</button>
      </div>

    </div>
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Projet</th>
          <th>LTV net</th>
          <th>Risque</th>
          <th>Tickets</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="bodyTable"></tbody>
    </table>
  </div>

</div>

<div id="overlay" onclick="toggleHelp()"></div>

<div id="helpPanel" class="help-panel">
  <h2>Guide d'analyse v3.4.0</h2>
  <p>Ce moteur IA combine LTV, LTA, LTC, marge, pr√©‚Äëcom, liquidit√© et garantie pour produire un score de risque, un statut et une suggestion de ticket.</p>

  <h3>1. Param√®tres cl√©s</h3>
  <ul>
    <li><b>LTV :</b> dette / valeur. &lt;60% excellent, 60‚Äì75% bon, 75‚Äì85% tendu, &gt;85% dangereux, &gt;100% critique.</li>
    <li><b>LTA :</b> dette / co√ªt d'acquisition. &lt;90% sain, 90‚Äì100% limite, &gt;100% critique (aucun apport r√©el).</li>
    <li><b>LTC :</b> dette / co√ªt total. &lt;85% sain, 85‚Äì90% tendu, &gt;90% dangereux.</li>
    <li><b>Marge :</b> coussin de s√©curit√©. &gt;20% excellent, 15‚Äì20% bon, 10‚Äì15% moyen, &lt;10% dangereux, &lt;5% critique.</li>
    <li><b>Pr√©‚Äëcom :</b> traction commerciale. &gt;80% tr√®s bon, 50‚Äì80% correct, 25‚Äì50% faible, &lt;25% dangereux.</li>
    <li><b>Liquidit√© :</b> 8‚Äì10 tr√®s liquide, 6‚Äì7 correct, 4‚Äì5 faible, &lt;4 tr√®s faible.</li>
    <li><b>Garantie :</b> fiducie = bonus s√©curit√©, hypoth√®que = neutre.</li>
  </ul>

  <h3>2. Score de risque</h3>
  <ul>
    <li><b>0‚Äì30 :</b> faible risque.</li>
    <li><b>30‚Äì50 :</b> risque mod√©r√©.</li>
    <li><b>50‚Äì70 :</b> risque √©lev√©.</li>
    <li><b>&gt;70 :</b> risque critique.</li>
  </ul>

  <h3>3. Statuts</h3>
  <ul>
    <li><b>üíé PREMIUM :</b> score ‚â§30, marge ‚â•20%, pr√©‚Äëcom ‚â•50%, LTV basse.</li>
    <li><b>‚úÖ SAFE :</b> score ‚â§50, aucun indicateur rouge.</li>
    <li><b>‚ö†Ô∏è TENDU :</b> score ‚â§70, un ou deux points faibles.</li>
    <li><b>üö® CRITIQUE :</b> LTV&gt;100%, marge&lt;5%, LTA&gt;100%, LTC&gt;90%, pr√©‚Äëcom&lt;25% ou score&gt;70.</li>
  </ul>

  <h3>4. Tickets IA</h3>
  <ul>
    <li><b>LTV&gt;90% :</b> IA ‚â§100‚Ç¨.</li>
    <li><b>80‚Äì90% :</b> IA ‚â§250‚Ç¨.</li>
    <li><b>LTA&gt;100% ou LTC&gt;90% :</b> IA ‚â§250‚Ç¨.</li>
    <li><b>Marge&lt;8% :</b> IA ‚â§150‚Ç¨ ; marge&lt;12% : IA ‚â§250‚Ç¨.</li>
    <li><b>Pr√©‚Äëcom&lt;25% :</b> IA ‚â§300‚Ç¨.</li>
    <li><b>Fiducie :</b> +150‚Ç¨ possible si score ‚â§50, sans d√©passer les plafonds.</li>
  </ul>

  <h3>5. Raccourci mental</h3>
  <ul>
    <li>LTA&gt;100% = rouge imm√©diat.</li>
    <li>LTC&gt;90% = structure tendue.</li>
    <li>Pr√©‚Äëcom&lt;25% = danger.</li>
    <li>Marge&lt;10% = faible coussin.</li>
    <li>Score&gt;70 = CRITIQUE, ticket minimal.</li>
  </ul>
</div>

<script>
function toggleHelp() {
  document.getElementById('helpPanel').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('open');
}

// --- Fonctions de calcul ---

function calculLtvNet(ltv, cov, type, liq) {
  const liqEffective = Math.min(10, liq + 2);
  const pondSurete = (type === 'fid') ? 1.2 : 1.0;
  let ltvNet = ltv - (cov / 100 * pondSurete * (liqEffective / 10) * 100);
  return Math.max(0, Math.round(ltvNet));
}

function calculScoreRisque(ltv, lta, ltc, marge, precom, liq, type) {
  let score = 0;

  if (ltv <= 60) score += 5;
  else if (ltv <= 75) score += 15;
  else if (ltv <= 85) score += 30;
  else score += 45;

  if (!isNaN(lta) && lta > 0) {
    if (lta <= 90) score += 5;
    else if (lta <= 100) score += 15;
    else score += 30;
  }

  if (!isNaN(ltc) && ltc > 0) {
    if (ltc <= 85) score += 5;
    else if (ltc <= 90) score += 15;
    else score += 30;
  }

  if (marge >= 20) score += 5;
  else if (marge >= 15) score += 15;
  else if (marge >= 10) score += 25;
  else score += 40;

  if (precom >= 80) score += 5;
  else if (precom >= 50) score += 15;
  else if (precom >= 25) score += 25;
  else score += 35;

  if (liq >= 8) score += 5;
  else if (liq >= 6) score += 15;
  else score += 30;

  if (type === 'fid') score -= 10;

  return Math.max(0, Math.min(100, Math.round(score)));
}

function calculSuggestionIA(ltv, lta, ltc, marge, precom, liq, type, scoreRisque) {
  let suggest = 1000;

  if (scoreRisque >= 80) suggest = 150;
  else if (scoreRisque >= 65) suggest = 250;
  else if (scoreRisque >= 50) suggest = 400;
  else if (scoreRisque >= 35) suggest = 600;
  else suggest = 800;

  if (ltv > 90) suggest = Math.min(suggest, 100);
  else if (ltv > 80) suggest = Math.min(suggest, 250);

  if (!isNaN(lta) && lta > 100) suggest = Math.min(suggest, 250);
  if (!isNaN(ltc) && ltc > 90) suggest = Math.min(suggest, 250);

  if (marge < 8) suggest = Math.min(suggest, 150);
  else if (marge < 12) suggest = Math.min(suggest, 250);

  if (precom < 25) suggest = Math.min(suggest, 300);

  if (type === 'fid' && scoreRisque <= 50) {
    suggest = Math.min(1000, suggest + 150);
  }

  suggest = Math.max(100, Math.min(1000, Math.round(suggest)));
  return suggest;
}

function calculStatut(scoreRisque, ltv, marge, precom) {
  if (ltv > 100) return "üö® CRITIQUE";
  if (marge < 5) return "üö® CRITIQUE";

  if (scoreRisque <= 30 && marge >= 20 && precom >= 50) return "üíé PREMIUM";
  if (scoreRisque <= 50) return "‚úÖ SAFE";
  if (scoreRisque <= 70) return "‚ö†Ô∏è TENDU";
  return "üö® CRITIQUE";
}

// --- Ajout / rendu ---

function ajouterProjet() {
  const nom = document.getElementById('nom').value || "Projet Master";

  const ltv = parseFloat(document.getElementById('ltv').value) || 0;
  const marge = parseFloat(document.getElementById('marge').value) || 0;
  const precom = parseFloat(document.getElementById('precom').value) || 0;
  const liq = parseInt(document.getElementById('liq').value) || 5;
  const type = document.getElementById('typeSurete').value;
  const cov = parseFloat(document.getElementById('cov').value) || 100;

  const lta = parseFloat(document.getElementById('lta')?.value) || 0;
  const ltc = parseFloat(document.getElementById('ltc')?.value) || 0;

  const realInvest = parseFloat(document.getElementById('realInvest').value) || 0;

  const ltvNet = calculLtvNet(ltv, cov, type, liq);
  const scoreRisque = calculScoreRisque(ltv, lta, ltc, marge, precom, liq, type);
  const suggest = calculSuggestionIA(ltv, lta, ltc, marge, precom, liq, type, scoreRisque);
  const status = calculStatut(scoreRisque, ltv, marge, precom);

  const p = {
    date: new Date().toLocaleDateString('fr-FR'),
    nom,
    ltv,
    marge,
    precom,
    liq,
    type,
    cov,
    lta,
    ltc,
    ltvNet,
    scoreRisque,
    status,
    investSuggest: suggest,
    investReal: realInvest
  };

  let db = JSON.parse(localStorage.getItem('immo_v34')) || [];
  db.push(p);
  localStorage.setItem('immo_v34', JSON.stringify(db));

  render();
  document.getElementById('realInvest').value = '';
}

function render() {
  const db = JSON.parse(localStorage.getItem('immo_v34')) || [];
  const body = document.getElementById('bodyTable');
  body.innerHTML = "";

  let sScore = 0, sTotal = 0;

  [...db].reverse().forEach((p, idx) => {
    sScore += p.scoreRisque || 0;
    sTotal += p.investReal || 0;

    let badgeClass;
    if (p.status.includes('üíé')) badgeClass = 'badge-premium';
    else if (p.status.includes('‚úÖ')) badgeClass = 'badge-safe';
    else if (p.status.includes('‚ö†Ô∏è')) badgeClass = 'badge-tendu';
    else badgeClass = 'badge-critique';

    body.innerHTML += `
      <tr>
        <td>
          <b>${p.nom}</b><br>
          <small style="color:var(--text-soft);">
            ${p.date} ‚Ä¢ Pr√©: ${p.precom}% ‚Ä¢ LTA: ${p.lta || '-'}% ‚Ä¢ LTC: ${p.ltc || '-'}%
          </small>
        </td>
        <td style="font-weight:bold;">
          ${p.ltvNet}%<br>
          <small style="color:var(--text-soft);">LTV brut: ${p.ltv}%</small>
        </td>
        <td>
          <span class="badge ${badgeClass}">${p.status}</span><br>
          <small style="color:var(--text-soft);">
            Marge: ${p.marge}% ‚Ä¢ Score: ${p.scoreRisque}/100
          </small>
        </td>
        <td>
          <small style="color:var(--text-soft);">IA: ${p.investSuggest}‚Ç¨</small><br>
          <b style="color:var(--blue)">R√âEL: ${p.investReal}‚Ç¨</b>
        </td>
        <td>
          <button onclick="suppr(${db.length - 1 - idx})"
                  style="border:none; background:none; cursor:pointer; color:var(--text-soft);">
            ‚úñ
          </button>
        </td>
      </tr>`;
  });

  if (db.length > 0) {
    const avgScore = Math.round(sScore / db.length);
    document.getElementById('avgRisk').innerText = avgScore + "/100";
    document.getElementById('totalInvest').innerText = sTotal + " ‚Ç¨";

    const label = document.getElementById('riskLabel');
    if (avgScore <= 30) { label.innerText = "S√âCURIS√â üõ°Ô∏è"; label.style.color = "var(--emerald)"; }
    else if (avgScore <= 50) { label.innerText = "√âQUILIBR√â ‚öñÔ∏è"; label.style.color = "var(--blue)"; }
    else if (avgScore <= 70) { label.innerText = "VIGILANCE ‚ö†Ô∏è"; label.style.color = "var(--amber)"; }
    else { label.innerText = "CRITIQUE üö®"; label.style.color = "var(--rose)"; }
  } else {
    document.getElementById('avgRisk').innerText = "0/100";
    document.getElementById('totalInvest').innerText = "0 ‚Ç¨";
    const label = document.getElementById('riskLabel');
    label.innerText = "Aucun projet";
    label.style.color = "var(--text-soft)";
  }
}

function suppr(idx) {
  let db = JSON.parse(localStorage.getItem('immo_v34')) || [];
  db.splice(idx, 1);
  localStorage.setItem('immo_v34', JSON.stringify(db));
  render();
}

function exportCSV() {
  const db = JSON.parse(localStorage.getItem('immo_v34')) || [];
  if (db.length === 0) return alert("Aucune donn√©e.");

  let csv = "Date;Nom;LTV;Marge;Precom;Liq;Surete;Couv;LTA;LTC;LTVNet;Score;Status;IA;Reel\n";
  db.forEach(p => {
    csv += `${p.date};${p.nom};${p.ltv};${p.marge};${p.precom};${p.liq};${p.type};${p.cov};${p.lta || ""};${p.ltc || ""};${p.ltvNet};${p.scoreRisque};${p.status};${p.investSuggest};${p.investReal}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.setAttribute("download", `Audit_Master_v34.csv`);
  link.click();
}

// --- Gestion du th√®me clair / sombre ---
function toggleTheme() {
  const isLight = document.body.classList.toggle("light");
  localStorage.setItem("theme", isLight ? "light" : "dark");

  // Mise √† jour du texte du bouton
  const btn = document.getElementById("themeBtn");
  btn.textContent = isLight ? "Mode sombre" : "Mode clair";
}

document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById("themeBtn");

  if (localStorage.getItem("theme") === "light") {
    document.body.classList.add("light");
    btn.textContent = "Mode sombre";
  } else {
    btn.textContent = "Mode clair";
  }

  render();
});
</script>

</body>
</html>




















